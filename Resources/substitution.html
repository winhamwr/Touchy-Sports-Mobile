<html>
<head>
	<title>Substitution</title>
	<script type="text/javascript" src="js/jquery-1.3.2.js"></script>
	<script type="text/javascript" src="js/teamspirit.player.js"></script>
	<script type="text/javascript" src="js/teamspirit.team.js"></script>
	<link href="css/substitution.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript">
		var lastClicked = null;
		var team = null;
		
		$(document).ready(function() {	
			// Create our test team--this should be loaded from the game data, or at least the
			// name of the player that is being subbed and an array of the benched players.
			var playerNames = new Array('Kail','Wes','Andy','Eric','Jack','Jim','Jose',
				'Alpha','Beta','Chi','Delta','Epsilon','Gamma','Omega','Sigma','Theta','Zeta');
			var teamPlayers = new Array();
			for (i=0; i<playerNames.length; i++) {
				teamPlayers[i] = new Player(i,playerNames[i],i);
			}
			team = new Team('Stepdads','Mini Me',teamPlayers);
			// TODO: Sort the roster
			
			drawPlayerTable(team);
			$('table td').click(function() {
				if (lastClicked != null) {
					$(lastClicked).parent().children().removeClass('highlighted');
					$(lastClicked).parent().children().addClass('normal');
				}
				$(this).parent().children().removeClass('normal');
				$(this).parent().children().addClass('highlighted');
				lastClicked = "'td:contains("+$(this).text()+")'";
			});
			
			// Make the roster scrollable
			jQuery('table').Scrollable(200, 300);
		});	
		
		function drawPlayerTable(team) {
				if (team != null) {
				$('table thead').append('<tr><th colspan=2>Who\'s going in for '+team.playersInPlay[0].name+'?</th></tr>');
				var playersList = '';
				for (a=0;a<team.playersBenched.length;a++) {
					playersList+='<tr><td class="playerNumber normal">'+team.playersBenched[a].number+'</td>'+
								 '<td class="playerName normal">'+team.playersBenched[a].name+'</td></tr>';
				}
				$('table tbody').append(playersList);
			};
		};
		
		function btnSub_click() {
			// Currently just testing with the first player in the PlayersInPlay array
			// and the player clicked in the benchedPlayers table.
			console.log(team.playersBenched);
			var subbingPlayerName = $(lastClicked).parent().find('td:eq(1)').text();
			// TODO: I need help with my jQuery selector above...it's grabbing the first element and the one
			// I want every time.  The following if statement is my temporary workaround...
			if (subbingPlayerName != team.playersBenched[0].name) {
				subbingPlayerName = subbingPlayerName.substring(team.playersBenched[0].name.length,subbingPlayerName.length);
			}
			console.log('Sub: '+subbingPlayerName+' is going in for '+team.playersInPlay[0].name+'...');
			team.sub(team.playersInPlay[0].name,subbingPlayerName);
			console.log('After sub():\nplayers in play: '+team.playersInPlay+'\n\n\nplayers benched: '+team.playersBenched);
			team.test2();
		};
		
		function btnCancel_click() {
			console.log('btnCancel was clicked.');
		};
 	</script>
</head>
 
<body>
	<table align="center" id="benchedPlayers">
		<thead></thead>
		<tbody></tbody>
	</table>
	<div class="btnBar">
		<div class="cntr">
			<button type="button" name="btnSub" class="btn" onClick="btnSub_click()">Sub</button>
			<button type="button" name="btnCancel" class="btn" onClick="btnCancel_click()">Cancel</button>
		</div>
	</div>
</body>
</html>