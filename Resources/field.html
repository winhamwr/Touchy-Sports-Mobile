<!DOCTYPE html>
<html>
<head>
<script type="text/javascript">
	// Check if we have debug=1 in the querystring
	var qs = document.location.search
	var debug_i = qs.indexOf('debug=1')
	if(debug_i != -1){
		DEBUG = true;
	} else{
		DEBUG = false;
	}
</script>
<script type="text/javascript" src="js/jquery-1.3.2.js"></script>

<script type="text/javascript" src="js/jquery-ui/ui.core.js"></script>
<script type="text/javascript" src="js/jquery-ui/ui.dialog.js"></script>
<script type="text/javascript" src="js/jquery-ui/effects.core.js"></script>
<script type="text/javascript" src="js/jquery-ui/effects.drop.js"></script>
<link type="text/css" href="css/substitution.css" rel="stylesheet" />
<link type="text/css" href="css/jquery-ui/redmond/ui.all.css" rel="stylesheet" />
<!--<link type="text/css" href="css/substitutionSouth.css" rel="stylesheet" />
<link type="text/css" href="css/jquery-ui/south-street/ui.all.css" rel="stylesheet" />-->
<script type="text/javascript" src="js/touchysports.team.js"></script>

<script type="text/javascript" src="js/jquery.ultimateCanvas.js"></script>
<script type="text/javascript" src="js/baseDbController.js"></script>
<script type="text/javascript" src="js/ts.dialogs.js"></script>
<script type="text/javascript" src="js/baseUiController.js"></script>
<script type="text/javascript" src="js/uiController.js"></script>

	<title>Touchy Sports&trade; | Ultimate Frisbee</title>
	<link href="css/field.css" rel="stylesheet" type="text/css">
</head>
<body>
	<div id="field_wrap">
		<div id="player-bar">
			<div>
				<div id="player-button-1"></div>
			</div>
			<div>
				<div id="player-button-2"></div>
			</div>
			<div>
				<div id="player-button-3"></div>
			</div>
			<div>
				<div id="player-button-4"></div>
			</div>
			<div>
				<div id="player-button-5"></div>
			</div>
			<div>
				<div id="player-button-6"></div>
			</div>
			<div>
				<div id="player-button-7"></div>
			</div>
		</div>
		<canvas id="field" width="480" height="320"></canvas>
		<div id="menu-bar">
			<div id="undo_b">
			</div>
			<div id="turnover_b">
			</div>
			<div id="sub_b">
			</div>
		</div>
	</div>
	<script type="text/javascript">
		$(document).ready(function(){

			/**
			 * Load the home team this game will use. If it's a continuation
			 * of an existing game, just load from the save. If it's not, then
			 * expect there to be a CURRENT_TEAM in sessionStorage.
			 */
			function loadHomeTeam() {

				var home_team_j = sessionStorage.getItem('CURRENT_TEAM');
                                console.log(home_team_j);
				if(home_team_j != null){
					sessionStorage.removeItem('CURRENT_TEAM');
					var home_team_d = JSON.parse(home_team_j);
					var home_team = new UltimateTeam(home_team_d['name'], home_team_d['players']);
					home_team.playersInPlay = home_team_d['playersInPlay'];

					return home_team;
				}

				var db = new db_controller();
				if(!db.gameExists()){
					alert("Error loading team. Must visit team management before starting a new game");
					1/0;
				}
			};

			var home_team = loadHomeTeam();

			var canvases = $('#field').ultimateCanvas(
				{
					ui_controller	:	ui_controller,
					db_controller	:	db_controller,
					home_team		:	home_team
				}
			);
		});
	</script>
</body>
</html>